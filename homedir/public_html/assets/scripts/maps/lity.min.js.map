{"version":3,"sources":["lity.js"],"names":["window","factory","define","amd","$","module","exports","require","lity","jQuery","Zepto","this","globalToggle","_html","_instanceCount","transitionEnd","element","deferred","Deferred","transitionEndEvent","one","resolve","setTimeout","promise","settings","currSettings","key","value","arguments","length","extend","parseQueryParams","params","p","pairs","decodeURI","split","obj","i","n","appendQueryParams","url","indexOf","param","error","msg","append","imageHandler","target","_imageRegexp","test","img","failed","reject","on","naturalWidth","inlineHandler","el","e","placeholder","after","instance","before","addClass","remove","iframeHandler","matches","_youtubeRegex","exec","autoplay","_vimeoRegex","_googlemapsRegex","output","options","keyup","keyCode","close","resize","height","document","documentElement","clientHeight","Math","round","_win","_content","css","floor","trigger","_instance","ready","content","find","each","always","removeClass","empty","_ready","init","handler","template","appendTo","esc","is","when","proxy","open","handlers","_defaultHandlers","_handlers","_defaultOptions","_options","popup","lateHandlers","name","call","callback","done","off","add","event","preventDefault","data","attr","blur","image","inline","iframe","createElement","transEndEventNames","WebkitTransition","MozTransition","OTransition","transition","undefined","style","version"],"mappings":"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","file":"lity.min.js","sourcesContent":["/*! Lity - v1.6.6 - 2016-04-22\n* http://sorgalla.com/lity/\n* Copyright (c) 2016 Jan Sorgalla; Licensed MIT */\n(function(window, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(['jquery'], function($) {\n            return factory(window, $);\n        });\n    } else if (typeof module === 'object' && typeof module.exports === 'object') {\n        module.exports = factory(window, require('jquery'));\n    } else {\n        window.lity = factory(window, window.jQuery || window.Zepto);\n    }\n}(typeof window !== \"undefined\" ? window : this, function(window, $) {\n    'use strict';\n\n    var document = window.document;\n\n    var _win = $(window);\n    var _html = $('html');\n    var _instanceCount = 0;\n\n    var _imageRegexp = /(^data:image\\/)|(\\.(png|jpe?g|gif|svg|webp|bmp|ico|tiff?)(\\?\\S*)?$)/i;\n    var _youtubeRegex = /(youtube(-nocookie)?\\.com|youtu\\.be)\\/(watch\\?v=|v\\/|u\\/|embed\\/?)?([\\w-]{11})(.*)?/i;\n    var _vimeoRegex =  /(vimeo(pro)?.com)\\/(?:[^\\d]+)?(\\d+)\\??(.*)?$/;\n    var _googlemapsRegex = /((maps|www)\\.)?google\\.([^\\/\\?]+)\\/?((maps\\/?)?\\?)(.*)/i;\n\n    var _defaultHandlers = {\n        image: imageHandler,\n        inline: inlineHandler,\n        iframe: iframeHandler\n    };\n\n    var _defaultOptions = {\n        esc: true,\n        handler: null,\n        template: '<div class=\"lity\" tabindex=\"-1\"><div class=\"lity-wrap\" data-lity-close><div class=\"lity-loader\">Loading...</div><div class=\"lity-container\"><div class=\"lity-content\"></div><button class=\"lity-close\" type=\"button\" title=\"Close (Esc)\" data-lity-close>Ã—</button></div></div></div>'\n    };\n\n    function globalToggle() {\n        _html[_instanceCount > 0 ? 'addClass' : 'removeClass']('lity-active');\n    }\n\n    var transitionEndEvent = (function() {\n        var el = document.createElement('div');\n\n        var transEndEventNames = {\n            WebkitTransition: 'webkitTransitionEnd',\n            MozTransition: 'transitionend',\n            OTransition: 'oTransitionEnd otransitionend',\n            transition: 'transitionend'\n        };\n\n        for (var name in transEndEventNames) {\n            if (el.style[name] !== undefined) {\n                return transEndEventNames[name];\n            }\n        }\n\n        return false;\n    })();\n\n    function transitionEnd(element) {\n        var deferred = $.Deferred();\n\n        if (!transitionEndEvent) {\n            deferred.resolve();\n        } else {\n            element.one(transitionEndEvent, deferred.resolve);\n            setTimeout(deferred.resolve, 500);\n        }\n\n        return deferred.promise();\n    }\n\n    function settings(currSettings, key, value) {\n        if (arguments.length === 1) {\n            return $.extend({}, currSettings);\n        }\n\n        if (typeof key === 'string') {\n            if (typeof value === 'undefined') {\n                return typeof currSettings[key] === 'undefined' ?\n                    null :\n                    currSettings[key];\n            }\n            currSettings[key] = value;\n        } else {\n            $.extend(currSettings, key);\n        }\n\n        return this;\n    }\n\n    function parseQueryParams(params){\n        var pairs = decodeURI(params).split('&');\n        var obj = {}, p;\n\n        for (var i = 0, n = pairs.length; i < n; i++) {\n            if (!pairs[i]) {\n                continue;\n            }\n\n            p = pairs[i].split('=');\n            obj[p[0]] = p[1];\n        }\n\n        return obj;\n    }\n\n    function appendQueryParams(url, params) {\n        return url + (url.indexOf('?') > -1 ? '&' : '?') + $.param(params);\n    }\n\n    function error(msg) {\n        return $('<span class=\"lity-error\"/>').append(msg);\n    }\n\n    function imageHandler(target) {\n        if (!_imageRegexp.test(target)) {\n            return false;\n        }\n\n        var img = $('<img src=\"' + target + '\">');\n        var deferred = $.Deferred();\n        var failed = function() {\n            deferred.reject(error('Failed loading image'));\n        };\n\n        img\n            .on('load', function() {\n                if (this.naturalWidth === 0) {\n                    return failed();\n                }\n\n                deferred.resolve(img);\n            })\n            .on('error', failed)\n        ;\n\n        return deferred.promise();\n    }\n\n    function inlineHandler(target) {\n        var el;\n\n        try {\n            el = $(target);\n        } catch (e) {\n            return false;\n        }\n\n        if (!el.length) {\n            return false;\n        }\n\n        var placeholder = $('<span style=\"display:none !important\" class=\"lity-inline-placeholder\"/>');\n\n        return el\n            .after(placeholder)\n            .on('lity:ready', function(e, instance) {\n                instance.one('lity:remove', function() {\n                    placeholder\n                        .before(el.addClass('lity-hide'))\n                        .remove()\n                    ;\n                });\n            })\n        ;\n    }\n\n    function iframeHandler(target) {\n        var matches, url = target;\n\n        matches = _youtubeRegex.exec(target);\n\n        if (matches) {\n            url = appendQueryParams(\n                'https://www.youtube' + (matches[2] || '') + '.com/embed/' + matches[4],\n                $.extend(\n                    {\n                        autoplay: 1\n                    },\n                    parseQueryParams(matches[5] || '')\n                )\n            );\n        }\n\n        matches = _vimeoRegex.exec(target);\n\n        if (matches) {\n            url = appendQueryParams(\n                'https://player.vimeo.com/video/' + matches[3],\n                $.extend(\n                    {\n                        autoplay: 1\n                    },\n                    parseQueryParams(matches[4] || '')\n                )\n            );\n        }\n\n        matches = _googlemapsRegex.exec(target);\n\n        if (matches) {\n            url = appendQueryParams(\n                'https://www.google.' + matches[3] + '/maps?' + matches[6],\n                {\n                    output: matches[6].indexOf('layer=c') > 0 ? 'svembed' : 'embed'\n                }\n            );\n        }\n\n        return '<div class=\"lity-iframe-container\"><iframe frameborder=\"0\" allowfullscreen src=\"' + url + '\"></iframe></div>';\n    }\n\n    function lity(options) {\n        var _options = {},\n            _handlers = {},\n            _instance,\n            _content,\n            _ready = $.Deferred().resolve();\n\n        function keyup(e) {\n            if (e.keyCode === 27) {\n                close();\n            }\n        }\n\n        function resize() {\n            var height = document.documentElement.clientHeight ? document.documentElement.clientHeight : Math.round(_win.height());\n\n            _content\n                .css('max-height', Math.floor(height) + 'px')\n                .trigger('lity:resize', [_instance])\n            ;\n        }\n\n        function ready(el, content) {\n            if (!_instance) {\n                return;\n            }\n\n            _content = $(content);\n\n            _win.on('resize', resize);\n            resize();\n\n            _instance\n                .find('.lity-loader')\n                .each(function() {\n                    var el = $(this);\n                    transitionEnd(el).always(function() {\n                        el.remove();\n                    });\n                })\n            ;\n\n            _instance\n                .removeClass('lity-loading')\n                .find('.lity-content')\n                .empty()\n                .append(_content)\n            ;\n\n            _content\n                .removeClass('lity-hide')\n                .trigger('lity:ready', [_instance, el])\n            ;\n\n            _ready.resolve();\n        }\n\n        function init(handler, content, options, el) {\n            _ready = $.Deferred();\n\n            _instanceCount++;\n            globalToggle();\n\n            _instance = $(options.template)\n                .addClass('lity-loading')\n                .appendTo('body');\n\n            if (!!options.esc) {\n                _win.on('keyup', keyup);\n            }\n\n            setTimeout(function() {\n                _instance\n                    .addClass('lity-opened lity-' + handler)\n                    .on('click', '[data-lity-close]', function(e) {\n                        if ($(e.target).is('[data-lity-close]')) {\n                            close();\n                        }\n                    })\n                    .trigger('lity:open', [_instance, el])\n                ;\n\n                $.when(content).always($.proxy(ready, null, el));\n            }, 0);\n        }\n\n        function open(target, options, el) {\n            var handler, content, handlers = $.extend({}, _defaultHandlers, _handlers);\n\n            options = $.extend(\n                {},\n                _defaultOptions,\n                _options,\n                options\n            );\n\n            if (options.handler && handlers[options.handler]) {\n                content = handlers[options.handler](target, popup);\n                handler = options.handler;\n            } else {\n                var lateHandlers = {};\n\n                // Run inline and iframe handlers after all other handlers\n                $.each(['inline', 'iframe'], function(i, name) {\n                    if (handlers[name]) {\n                        lateHandlers[name] = handlers[name];\n                    }\n\n                    delete handlers[name];\n                });\n\n                var call = function(name, callback) {\n                    // Handler might be \"removed\" by setting callback to null\n                    if (!callback) {\n                        return true;\n                    }\n\n                    content = callback(target, popup);\n\n                    if (!!content) {\n                        handler = name;\n                        return false;\n                    }\n                };\n\n                $.each(handlers, call);\n\n                if (!handler) {\n                    $.each(lateHandlers, call);\n                }\n            }\n\n            if (content) {\n                $.when(close()).done($.proxy(init, null, handler, content, options, el));\n            }\n\n            return !!content;\n        }\n\n        function close() {\n            if (!_instance) {\n                return;\n            }\n\n            var deferred = $.Deferred();\n\n            _ready.done(function() {\n                _instanceCount--;\n                globalToggle();\n\n                _win\n                    .off('resize', resize)\n                    .off('keyup', keyup)\n                ;\n\n                _content.trigger('lity:close', [_instance]);\n\n                _instance\n                    .removeClass('lity-opened')\n                    .addClass('lity-closed')\n                ;\n\n                var instance = _instance, content = _content;\n                _instance = null;\n                _content = null;\n\n                transitionEnd(content.add(instance)).always(function() {\n                    content.trigger('lity:remove', [instance]);\n                    instance.remove();\n                    deferred.resolve();\n                });\n            });\n\n            return deferred.promise();\n        }\n\n        function popup(event) {\n            // If not an event, act as alias of popup.open\n            if (!event.preventDefault) {\n                return popup.open(event);\n            }\n\n            var el = $(this);\n            var target = el.data('lity-target') || el.attr('href') || el.attr('src');\n\n            if (!target) {\n                return;\n            }\n\n            var options = el.data('lity-options') || el.data('lity');\n\n            if (open(target, options, el)) {\n                el.blur();\n                event.preventDefault();\n            }\n        }\n\n        popup.handlers = $.proxy(settings, popup, _handlers);\n        popup.options = $.proxy(settings, popup, _options);\n\n        popup.open = function(target, options, el) {\n            open(target, options, el);\n            return popup;\n        };\n\n        popup.close = function() {\n            close();\n            return popup;\n        };\n\n        return popup.options(options);\n    }\n\n    lity.version = '1.6.6';\n    lity.handlers = $.proxy(settings, lity, _defaultHandlers);\n    lity.options = $.proxy(settings, lity, _defaultOptions);\n\n    $(document).on('click', '[data-lity]', lity());\n\n    return lity;\n}));\n"],"sourceRoot":"/source/"}